id: iam-004
name: iam:CreateLoginProfile
category: lateral-movement
services:
- iam
description: Anyone with access to `iam:CreateLoginProfile` can create console login profiles for any user they have this
  permission on. This permission is often abused by one principal to gain access to another principal and the permissions
  associated with that principal via the AWS Console.
prerequisites:
  admin:
  - Target user must NOT currently have a login profile
  - Target user must have administrative permissions (e.g., AdministratorAccess)
  lateral:
  - Target user must NOT currently have a login profile
exploitationSteps:
  awscli:
  - step: 1
    command: aws iam create-login-profile --user-name @username --password @password
    description: Create a console login profile with a known password for the target user
  - step: 2
    command: '# Login to AWS Console with the username and password'
    description: Access AWS Console as the target user
recommendation: |
  Restrict access to `iam:CreateLoginProfile` using the principle of least privilege. Only allow
  users to create login profiles for users they are authorized to manage. Very few principals
  need this permission on anyone other than themselves, so it should be restricted to only the
  few principals that need it. Monitor use of this sensitive permission using CloudSIEM
  detections, and look for usage anomalies.
discoveredBy:
  name: Spencer Gietzen
  organization: Rhino Security Labs
  date: '2019'
references:
- title: AWS Privilege Escalation Methods and Mitigation
  url: https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/
relatedPaths:
- iam-002
- iam-006
toolSupport:
  pmapper: true
  iamVulnerable: true
permissions:
  required:
  - permission: iam:CreateLoginProfile
    resourceConstraints: Target IAM user must be in the Resource section
  additional:
  - permission: iam:ListUsers
    resourceConstraints: Helpful for discovering target users
  - permission: iam:GetUser
    resourceConstraints: Useful for viewing user details
