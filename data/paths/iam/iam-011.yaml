id: iam-011
name: iam:PutGroupPolicy
category: self-escalation
services:
- iam
description: Anyone with access to `iam:PutGroupPolicy` can attach inline policies to any group they have this permission
  on. This permission is often abused by one principal to grant additional permissions to themselves by attaching an inline
  policy to a group they are a member of.
prerequisites:
- Principal must be a user (not a role)
- Principal must be a member of the target group
exploitationSteps:
  awscli:
  - step: 1
    command: aws iam put-group-policy --group-name @groupname --policy-name @policyname --policy-document file://escalation_policy.json
    description: Attach an inline policy with elevated permissions to the group
  - step: 2
    command: aws sts get-caller-identity
    description: Verify the new permissions are active
recommendation: |
  Restrict access to `iam:PutGroupPolicy` using the principle of least privilege. Very few
  principals need this permission, so it should be restricted to only the few principals
  that need it. Monitor use of this sensitive permission using CloudSIEM detections,
  and look for usage anomalies.
discoveredBy:
  name: Spencer Gietzen
  organization: Rhino Security Labs
  date: '2019'
references:
- title: AWS Privilege Escalation Methods and Mitigation
  url: https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/
relatedPaths:
- iam-005
- iam-007
- iam-010
detectionRules:
- platform: CloudSIEM
  url: https://docs.datadoghq.com/security/default_rules/7b6-2a8-df9/
toolSupport:
  pmapper: true
  iamVulnerable: true
permissions:
  required:
  - permission: iam:PutGroupPolicy
    resourceConstraints: Target group must be in the Resource section. For self-escalation, must have permission on a group
      the principal belongs to.
