id: iam-010
name: iam:AttachGroupPolicy
category: self-escalation
services:
- iam
description: Anyone with access to `iam:AttachGroupPolicy` can attach managed policies to any group they have this permission
  on. This permission is frequently exploited by a principal to grant themselves additional privileges by attaching policies
  to a group they are a member of. A principal can also leverage this to escalate the permissions of other principals in the
  same group.
prerequisites:
- Principal must be a user (not a role)
- Principal must be a member of the target group
- A managed IAM policy with elevated privileges must exist in the account
exploitationSteps:
  awscli:
  - step: 1
    command: aws iam attach-group-policy --group-name @groupname --policy-arn arn:aws:iam::aws:policy/AdministratorAccess
    description: Attach the AdministratorAccess managed policy to the group
  - step: 2
    command: aws sts get-caller-identity
    description: Verify the new permissions are active
recommendation: |
  Restrict access to `iam:AttachGroupPolicy` using the principle of least privilege. Very few
  principals need this permission, so it should be restricted to only the few principals
  that need it. Monitor use of this sensitive permission using CloudSIEM detections,
  and look for usage anomalies.
discoveredBy:
  name: Spencer Gietzen
  organization: Rhino Security Labs
  date: '2019'
references:
- title: AWS Privilege Escalation Methods and Mitigation
  url: https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/
relatedPaths:
- iam-008
- iam-011
detectionRules:
- platform: CloudSIEM
  url: https://docs.datadoghq.com/security/default_rules/7b6-2a8-df9/
toolSupport:
  pmapper: true
  iamVulnerable: true
permissions:
  required:
  - permission: iam:AttachGroupPolicy
    resourceConstraints: Target group must be in the Resource section. For self-escalation, must have permission on a group
      the principal belongs to.
