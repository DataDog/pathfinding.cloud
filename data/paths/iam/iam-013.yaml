id: iam-013
name: iam:AddUserToGroup
category: lateral-movement
services:
- iam
description: A principal with `iam:AddUserToGroup` can add any user to any group they have this permission on. By adding themselves
  or another user to a group with elevated permissions, they can gain access to the policies attached to that group. The level
  of access gained depends on the permissions of the target group.
prerequisites:
  admin:
  - A group must exist with administrative permissions (e.g., AdministratorAccess)
  lateral:
  - A group must exist with some level of permissions
exploitationSteps:
  awscli:
  - step: 1
    command: aws iam add-user-to-group --user-name @username --group-name @privileged-group
    description: Add the target user (or yourself) to a group with elevated permissions
  - step: 2
    command: aws sts get-caller-identity
    description: Verify the new permissions are active
recommendation: |
  Restrict access to `iam:AddUserToGroup` using the principle of least privilege. Only allow
  users to add users to groups they are authorized to manage. Very few principals need this
  permission, so it should be restricted to only the few principals that need it.

  Use IAM policy conditions to restrict which groups users can be added to:

  ```json
  {
    "Effect": "Allow",
    "Action": "iam:AddUserToGroup",
    "Resource": "arn:aws:iam::ACCOUNT_ID:group/SpecificGroup"
  }
  ```

  Monitor CloudTrail for unusual AddUserToGroup activity, especially adding users to
  privileged groups.
discoveredBy:
  name: Spencer Gietzen
  organization: Rhino Security Labs
  date: '2019'
references:
- title: AWS Privilege Escalation Methods and Mitigation
  url: https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/
- title: IAM Vulnerable - AddUserToGroup
  url: https://github.com/BishopFox/iam-vulnerable
relatedPaths:
- iam-008
- iam-010
toolSupport:
  pmapper: true
  iamVulnerable: true
permissions:
  required:
  - permission: iam:AddUserToGroup
    resourceConstraints: Target group must be in the Resource section
  additional:
  - permission: iam:ListUsers
    resourceConstraints: Helpful for discovering target users
  - permission: iam:GetUser
    resourceConstraints: Useful for viewing user details
