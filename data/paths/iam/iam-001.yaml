id: iam-001
name: iam:CreatePolicyVersion
category: self-escalation
services:
- iam
description: Anyone with access to `iam:CreatePolicyVersion` can create a new version of an IAM policy. If a user can create
  a new version of a policy that is already attached to them, they can grant themselves administrative privileges by creating
  a new policy version with elevated permissions and setting it as the default version. A principal can also leverage this
  to escalate the permissions of another principal they can access.
prerequisites:
- condition: Policy must already be attached to the actor's user, role, or group
  type: resource-state
exploitationSteps:
  awscli:
  - step: 1
    command: aws iam create-policy-version --policy-arn @arn --policy-document file://admin_policy.json --set-as-default
    description: Create a new policy version with administrative permissions and set it as default
  pacu:
  - step: 1
    command: run iam__privesc_scan
    description: Scan for IAM privilege escalation opportunities including CreatePolicyVersion
recommendation: |
  Restrict access to `iam:CreatePolicyVersion` using the principle of least privilege.
  Very few principals need this permission, so it should be restricted to only the
  few principals that need it. Monitor use of this sensitive permission using
  CloudSIEM detections, and look for usage anomalies.
discoveredBy:
  name: Spencer Gietzen
  organization: Rhino Security Labs
  date: '2019'
references:
- title: AWS Privilege Escalation Methods and Mitigation
  url: https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/
relatedPaths:
- iam-007
- iam-008
detectionRules:
- platform: CloudSIEM
  url: https://docs.datadoghq.com/security/default_rules/7b6-2a8-df9/
toolSupport:
  pmapper: true
  iamVulnerable: true
permissions:
  required:
  - permission: iam:CreatePolicyVersion
    resourceConstraints: Policy ARN must be in the Resource section and policy must be attached to the actor
