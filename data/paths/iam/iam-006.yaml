id: iam-006
name: iam:UpdateLoginProfile
category: lateral-movement
services:
- iam
description: Anyone with access to `iam:UpdateLoginProfile` can change the password of any user they have this permission
  on. This privilege escalation path requires the user to already have a password set (login profile exists). This permission
  is often abused by one principal to gain access to another principal and the permissions associated with that principal.
prerequisites:
  admin:
  - Target user must already have a login profile (password)
  - Target user must have administrative permissions (e.g., AdministratorAccess)
  lateral:
  - Target user must already have a login profile (password)
exploitationSteps:
  awscli:
  - step: 1
    command: aws iam update-login-profile --user-name @username --password @password
    description: Change the password for the target user's console login
  - step: 2
    command: '# Login to AWS Console with the username and new password'
    description: Access AWS Console as the target user
recommendation: |
  Restrict access to `iam:UpdateLoginProfile` using the principle of least privilege. Only allow
  users to update the password of users they are authorized to manage, most commonly, themselves.
  Very few principals need this permission on all principals, so it should be restricted to only
  the few principals that need it. Monitor use of this sensitive permission using CloudSIEM
  detections, and look for usage anomalies.
discoveredBy:
  name: Spencer Gietzen
  organization: Rhino Security Labs
  date: '2019'
references:
- title: AWS Privilege Escalation Methods and Mitigation
  url: https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/
relatedPaths:
- iam-002
- iam-004
toolSupport:
  pmapper: true
  iamVulnerable: true
permissions:
  required:
  - permission: iam:UpdateLoginProfile
    resourceConstraints: Target IAM user must be in the Resource section
  additional:
  - permission: iam:ListUsers
    resourceConstraints: Helpful for discovering target users
  - permission: iam:GetUser
    resourceConstraints: Useful for viewing user details
